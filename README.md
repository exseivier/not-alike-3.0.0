# Not-Alike pipeline: application in molecular diagnostics for pathogen microorganism detection

## Overview

This pipeline identifies genomic regions which are the most dissimilar compared at least to one genome of a database composed with several genomes sequences. It uses bioinformatic tools to accomplish this task such as NCBI datasets, dataformat[Download](https://www.ncbi.nlm.nih.gov/datasets/docs/v2/download-and-install/) and blastn [Download](https://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/), Primer3_core[Download](https://github.com/primer3-org/primer3),  hisat2 [Download](https://daehwankimlab.github.io/hisat2/download/#version-hisat2-221), samtools [Download](https://www.htslib.org/download/), stringtie [Download](https://ccb.jhu.edu/software/stringtie/#install) and gffread [Download](https://github.com/gpertea/gffread). These executables should be inside a binaries folder and exported to the PATH environment variable. This pipeline has three steps: **(1)** split query genome, **(2)** iterative searching and **(3)** mapping & assembling. The result is a GTF file generated by stringtie which assembles the dissimilar fragments not-alike found. Using gffread you can get the sequences of those assembled fragments.

## Introduction

This commands pipeline finds unique dissimilar regions of the genome of interest employing iterative sequence comparison between all possible fragments of size "window size" at each step size "step size" of the genome. It is written in Python language and uses external bioinformatic tools such as blastn, hisat2, samtools, stringtie, NCBI datasets and dataformat, and gffread. Also, it uses the following Python packages: biopython, pandas, click, os, random and subprocess which handles the communication with Python and the external tools. This commands pipeline works with datasets downloaded from NCBI, thus it is needed to install datasets and dataformat NCBI tools to manipulate genomes database obtained from NCBI datasets. As we pointed out above, it has three steps.

**Split genome step**. In this step, the genome of interest is split into fragments of defined size (window size) with a sliding window method that cuts fragments at each step of determined size (step size). In the **iterative searching step**, fragments are used as a query to search the genomes database, genome by genome, and fragments that hit a subsequence of the searched genome are eliminated form the fragments file. This procedure is iteratively performed until the end of the genome database. The final step is the **mapping & assembly**. In this step, the remained fragments are subject to be mapped to the reference genome, which is the same genome where fragments come from, with hisat2, samtools and stringtie. The resulting GTF file contains the coordinates of the assembled fragments. Those assembled fragments are the dissimilar regions.


## Usage

To ask for help.

```bash
not-alike3 --help

Usage: not-alike3 [OPTIONS] COMMAND [ARGS]...

  Not-Alike: Command pipeline that identifies dissimilar regions of a target
  genome by comparing it to a genomes database.

Options:
  --help  Show this message and exit.

Commands:
  assm-stats      Calculates assembly statistics such as: Mean, Median,...
  db-makeblast    Builds a BLAST_DB (version 5) database files
  db-makefile     Creates the database text file which contains the...
  search          Searches for not alike fragments in query genome
  search-primers  Selects the best fitted primer sequences based on input...
  show-db         Shows metadata of database [accession number, organism...
  show-exp        Shows information about epxeriments stored in the...
```

To ask for help for every command.

```bash
not-alike3 <command> --help
```

Build database. The database path is where FASTA genome folders and the JSON files of metadata are.

```bash
not-alike3 db-makeblast -db /path/to/database
```

Prepare the database text file. It contains the sorted path and names of FASTA genome files.

```bash
not-alike3 db-makefile -qg query/target_genome.fasta -db /path/to/database/ [-e ACCESSION,...,ACCESSION | -i ACCESSION,...,ACCESSION] -o database_text_file.txt
```

Search task execution.

```bash
not-alike search -g test/seqs/target_genome.fasta -db /path/to/database/database_text_file.txt -c 'Leave a comment encolsed by single quotes' --config-file <file.toml>
```

Design primers.

```bash
not-alike3 search-primers --input-file unique_dissimilar_regions.fasta --opt-size 20 --opt-gc 55 --opt-tm 58 --product-size 100-500 --template-size-range 1000-2000
```

Example of TOML configuration file.

```bash
# Commentaries
[global]
num_of_cores = 2
quite_opposite = false

[[split]]
window_size = 500
step_size = 50

[[search]]
quite_opposite = false
name = 'test2'
task = 'blastn'
identity = 50
qcov = 50
evalue = 100
```

## Commands

### database-makeblastdb

Creates a database of BLAST\_DB version 5 files from an NCBI genomes dataset downloaded with the dataset tool. It reads the dataset\_catalog.json to get the path to FASTA files.

### database-makefiledb

Creates a text file with the path and names where BLAST\_DB files are separated by return characters. This command uses a quick sorting procedure based on sequence comparison to sort the genome database from most similar to the most dissimilar database genome compared with the genome of interest.

### search

This command finds unique dissimilar regions of a genome of interest through iterative sequence comparison analysis.

### search-primers

This command designs PCR primers using unique dissimilar regions identified by **search** command in the genome of interest as templates.

### show-database

This command transforms the assembly\_data\_report.jsonl file, metadata downloaded from NCBI datasets, to TSV format file with dataformat NCBI tool and prints on screen the accession number, organism name and ID of organism taxon.

### show-exp

It reads the 'experiments.log' log file stored in the log folder and prints on screen the information contained in it which are information about parameter values, process ID and the date of experiments previously done.

## Results explanation

The results folder should look like this.

```bash
├── blast_db
├── blast_out
│   └── out.blast
├── gtfs
│   ├── nal_frags.4745693059.fasta
│   ├── nal_frags.4745693059.gtf
│   ├── nal_frags.4745693059.inp3
│   ├── nal_frags.4745693059.outp3
│   ├── nal_frags.4745693059.sort.prm
│   └── tmp.gff
├── ht2_idx
│   ├── GCF_000002545.3_ASM254v2_genomic.1.ht2
│   ├── GCF_000002545.3_ASM254v2_genomic.2.ht2
│   ├── GCF_000002545.3_ASM254v2_genomic.3.ht2
│   ├── GCF_000002545.3_ASM254v2_genomic.4.ht2
│   ├── GCF_000002545.3_ASM254v2_genomic.5.ht2
│   ├── GCF_000002545.3_ASM254v2_genomic.6.ht2
│   ├── GCF_000002545.3_ASM254v2_genomic.7.ht2
│   └── GCF_000002545.3_ASM254v2_genomic.8.ht2
├── log
│   ├── experiments.log
│   └── stats.log
├── mapping
│   ├── nal_frags.4745693059.bam
│   ├── nal_frags.4745693059.sam
│   └── nal_frags.4745693059.sort.bam
├── query
│   ├── GCF_000002545.3_ASM254v2_genomic.fna
│   └── GCF_000002545.3_ASM254v2_genomic.fna.fai
├── split_out
│   ├── GCF_000002545.3_ASM254v2_genomic_split_500_50.fasta
│   ├── input_split.3496921943.fasta
│   ├── input_split.4745693059.fasta
│   └── tmp.split
└── toml
    ├── blastn_50.toml
    ├── megablast_15.toml
    └── megablast_50.toml
```

The results folder looks like that tree topology. The folder *blast\_out* contains a file called out.blast which temporarily stores the blast output of iterative searching. The *gtfs* folder contains the unique dissimilar regions of a genome of interest identified with **search** command in FASTA and GTF format. This folder also contains the output files of the primer designing task done with the search-primer command (file format INP3, OUTP3 and SORT.PRM). The *ht2\_idx* folder contains the index files for hisat2 of the reference genome which is the genome of interest. The *log* folder contains the experiments and assembly statistics logs. The *mapping* folder contains the SAM and BAM files of mapped fragments. The *query* folder contains the FASTA genome of interest. The *split\_out* folder contains the FASTA split genome of interest and the input files that are used in iterative searching. The *toml* folder contains the TOML configuration files. In the beginning, it is needed to create *query* and *toml* folders to store the FASTA genome of interest and the TOML configuration files. It is also possible to allocate the database folder inside the results folder, or it can be outside.

## Download & install

#### Download the zipped file at [exseivier's github](https://www.github.com/exseivier/not-alike3-3.0.0)

```bash
unzip main.zip

cd not-alike3-3.0.0-main

python3 -m pip install dist/not-alike3-3.0.0.tar.gz
```

## Watch the YouTube video that explains download, installation and usage instructions.
[Not-alike3 installation and usage guide](https://youtu.be/rwltheAmX0Y?si=mJIva2j6Fm6KnqbZ)

